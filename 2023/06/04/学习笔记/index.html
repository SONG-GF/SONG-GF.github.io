<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>欢迎来到我的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="学习笔记一些小知识理解Commonjs与Es Module的区别 代码运行时间点 导出语法 导出值修改不同  CommonJs  CommonJs可以动态加载语句，代码发生在运行时 CommonJs混合导出，还是一种语法，只不过不用声明前面对象而已，当我导出引用对象时之前的导出就被覆盖了 CommonJs导出值是拷贝，可以修改导出的值，这在代码出错时，不好排查引起变量污染  Es Module">
<meta property="og:type" content="article">
<meta property="og:title" content="欢迎来到我的博客">
<meta property="og:url" content="http://example.com/2023/06/04/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="欢迎来到我的博客">
<meta property="og:description" content="学习笔记一些小知识理解Commonjs与Es Module的区别 代码运行时间点 导出语法 导出值修改不同  CommonJs  CommonJs可以动态加载语句，代码发生在运行时 CommonJs混合导出，还是一种语法，只不过不用声明前面对象而已，当我导出引用对象时之前的导出就被覆盖了 CommonJs导出值是拷贝，可以修改导出的值，这在代码出错时，不好排查引起变量污染  Es Module">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-06-04T15:39:54.176Z">
<meta property="article:modified_time" content="2023-06-04T12:50:14.088Z">
<meta property="article:author" content="SONG-GF">
<meta property="article:tag" content="blog">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="欢迎来到我的博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">欢迎来到我的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/06/04/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-06-04T15:39:54.176Z" itemprop="datePublished">2023-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="学习笔记"><a href="#学习笔记" class="headerlink" title="学习笔记"></a>学习笔记</h2><h2 id="一些小知识理解"><a href="#一些小知识理解" class="headerlink" title="一些小知识理解"></a>一些小知识理解</h2><h3 id="Commonjs与Es-Module的区别"><a href="#Commonjs与Es-Module的区别" class="headerlink" title="Commonjs与Es Module的区别"></a><strong>Commonjs</strong>与<strong>Es Module</strong>的区别</h3><ol>
<li>代码运行时间点</li>
<li>导出语法</li>
<li>导出值修改不同</li>
</ol>
<p><strong>CommonJs</strong></p>
<ul>
<li>CommonJs可以动态加载语句，代码发生在运行时</li>
<li>CommonJs混合导出，还是一种语法，只不过不用声明前面对象而已，当我导出引用对象时之前的导出就被覆盖了</li>
<li>CommonJs导出值是拷贝，可以修改导出的值，这在代码出错时，不好排查引起变量污染</li>
</ul>
<p><strong>Es Module</strong></p>
<ul>
<li>Es Module是静态的，不可以动态加载语句，只能声明在该文件的最顶部，代码发生在编译时</li>
<li>Es Module混合导出，单个导出，默认导出，完全互不影响</li>
<li>Es Module导出是引用值之前都存在映射关系，并且值都是可读的，不能修改</li>
</ul>
<h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><p>分支管理：</p>
<p>git init 初始化</p>
<p>git branch：列出所有本地分支。</p>
<p>git branch -a：列出所有本地和远程分支。</p>
<p>git branch <branchname>：创建新的分支。</p>
<p>git checkout <branchname>：切换到指定分支。</p>
<p>git checkout -b <branchname>：创建并切换到新的分支。</p>
<p>git branch -d <branchname>：删除本地分支。</p>
<p>git push origin –delete <branchname>：删除远程分支。</p>
<p>git remote -v   查看远程仓库的信息</p>
<p> 合并代码：</p>
<p>git merge <branchname>：将指定分支合并到当前分支。</p>
<p>git rebase <branchname>：将当前分支的提交基地移动到指定分支的最新提交之上。</p>
<p>git cherry-pick <commit>：选择一个特定的提交并将其应用到当前分支。</p>
<p>git stash：保存当前工作目录的修改，并将工作目录恢复到上一个提交的状态。</p>
<p>git fetch origin master ：将远程版本库中的最新代码同步到本地</p>
<p>执行这个命令后，就会将远程版本库上的代码同步到本地，不过<br>同步下来的代码并不会 合并到任何分支上去，而是会存放在到<br>一个 origin&#x2F;master 分支上,之后再调用 merge 命令将<br>origin&#x2F;master 分支上的修改合并到主分支上即可</p>
<p> 处理冲突：</p>
<p>当合并或 rebase 操作引起冲突时，需要手动解决冲突。</p>
<p>git status：查看冲突文件的状态。</p>
<p>打开冲突文件，解决冲突并保存修改。</p>
<p>git add <filename>：将解决冲突的文件标记为已解决。</p>
<p>git commit：完成合并或 rebase 操作的提交。</p>
<p>  协同开发流程：</p>
<p>克隆远程仓库：git clone <repository>。</p>
<p>创建分支：git branch <branchname>。</p>
<p>切换到新分支：git checkout <branchname>。</p>
<p>在新分支上进行开发。</p>
<p>提交代码：git add <filename> 和 git commit -m “Commit message”。</p>
<p>推送分支到远程仓库：git push origin <branchname>。</p>
<p>在远程仓库上发起合并请求（Pull Request）。</p>
<p>进行代码审查和讨论。</p>
<p>合并代码到主分支（通常是主线分支）。</p>
<p>这些是一些常见的 Git 命令，用于协同开发过程中的分支管理、合并代码和处理冲突等操作。根据实际情况，你还可以进一步探索 Git</p>
<p>的高级功能和命令。</p>
<h2 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h2><h2 id="js部分"><a href="#js部分" class="headerlink" title="js部分"></a>js部分</h2><p><strong>可选链运算符</strong>（**<code>?.</code>**）允许读取位于连接对象链深处的属性的值，而不必明确验证链中的每个引用是否有效。<code>?.</code> 运算符的功能类似于 <code>.</code> 链式运算符，不同之处在于，在引用为空 (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Nullish">nullish</a> ) (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/null"><code>null</code></a> 或者 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a>) 的情况下不会引起错误，该表达式短路返回值是 <code>undefined</code>。与函数调用一起使用时，如果给定的函数不存在，则返回 <code>undefined</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> adventurer = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">  <span class="attr">cat</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Dinah&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dogName = adventurer.<span class="property">dog</span>?.<span class="property">name</span>;</span><br><span class="line"><span class="keyword">const</span> catName = adventurer.<span class="property">cat</span>?.<span class="property">name</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dogName);<span class="comment">//undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(catName);<span class="comment">//&#x27;Dinah&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="js数字操作"><a href="#js数字操作" class="headerlink" title="js数字操作"></a>js数字操作</h4><p><strong>toFixed</strong>()：可把 Number 四舍五入为指定小数位数的数字。但需要注意的是，它的返回值其实是个字符串，入参须是一个正整数，而且只能作用于number类型否则会报错。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let a = 1.111111</span><br><span class="line">let b = a.toFixed(2);</span><br></pre></td></tr></table></figure>

<p>  缺点：tofixed()并不是稳定的四舍五入，有时候会出错</p>
<p><strong>parseInt()</strong>:可以将字符串转换为整数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parseInt(string, radix) //string必传，radix设置要解析的数字的基数。该值介于 2 ~ 36 之间，也就是几进制</span><br></pre></td></tr></table></figure>

<p><strong>parseFloat()</strong>:可解析一个字符串，并返回一个浮点数。 需要注意的是，在解析过程中遇到了正负号（+ 或 -）、数字 (0-9)、小数点，或者科学记数法中的指数（e 或 E）以外的字符，则它会忽略该字符以及之后的所有字符，返回当前已经解析到的浮点数。同时参数字符串首位的空白符会被忽略。<br>如果参数字符串的第一个字符不能被解析成为数字，则 parseFloat 返回 NaN。</p>
<h4 id="js字符串操作"><a href="#js字符串操作" class="headerlink" title="js字符串操作"></a>js字符串操作</h4><p><strong>replace()</strong> :在字符串中搜索值或正则表达式,返回已替换值的新字符串,<strong>不会更改原始字符串</strong></p>
<p>如果您替换值，则只会替换第一个实例。如需替换所有实例，请使用带有 <code>g</code> 修饰符集的正则表达式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> text = <span class="string">&quot;Visit Microsoft!&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> result = text.<span class="title function_">replace</span>(<span class="string">&quot;Microsoft&quot;</span>, <span class="string">&quot;W3School&quot;</span>);</span><br><span class="line"><span class="comment">//全局替换</span></span><br><span class="line"><span class="keyword">let</span> text = <span class="string">&quot;Mr Blue has a blue house and a blue car&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> result = text.<span class="title function_">replace</span>(<span class="regexp">/blue/g</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//全局替换，不区分大小写的替换</span></span><br><span class="line"><span class="keyword">let</span> text = <span class="string">&quot;Mr Blue has a blue house and a blue car&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> result = text.<span class="title function_">replace</span>(<span class="regexp">/blue/gi</span>, <span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>substr()</strong>:提取字符串的一部分,从指定位置开始，并返回指定数量的<strong>字符</strong>,<strong>不会更改原始字符串</strong></p>
<p>如需从字符串末尾提取字符，请使用负数的起始位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> text = <span class="string">&quot;Hello world!&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> result = text.<span class="title function_">substr</span>(<span class="number">1</span>, <span class="number">4</span>);<span class="string">&quot;//Hell</span></span><br><span class="line"><span class="string">//从位置 2 开始：</span></span><br><span class="line"><span class="string">let result = text.substr(2);</span></span><br><span class="line"><span class="string">//提取最后六个：</span></span><br><span class="line"><span class="string">let result = text.substr(-5, 5);</span></span><br></pre></td></tr></table></figure>

<p><strong>split()</strong>:将字符串拆分为子字符串<strong>数组</strong>,<strong>不会更改原始字符串</strong></p>
<p>如果 (“ “) 用作分隔符，则字符串在单词之间进行拆分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//语法</span></span><br><span class="line">tring.<span class="title function_">split</span>(separator, limit)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> text = <span class="string">&quot;How are you doing today?&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> myArray = text.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line"><span class="comment">//使用字母作为分隔符：</span></span><br><span class="line"><span class="keyword">const</span> myArray = text.<span class="title function_">split</span>(<span class="string">&quot;o&quot;</span>);</span><br><span class="line"><span class="comment">//限制拆分数量</span></span><br><span class="line"><span class="keyword">const</span> myArray = text.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>



<h4 id="js数组对象操作"><a href="#js数组对象操作" class="headerlink" title="js数组对象操作"></a>js数组对象操作</h4><p>参考地址：[(27条消息) 常用js的数组方法和对象方法_她梦的博客-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44890872/article/details/103324937#:~:text=%E6%95%B0%E7%BB%84%E7%9A%84%E6%96%B9%E6%B3%95">https://blog.csdn.net/qq_44890872/article/details/103324937#:~:text=数组的方法</a> 1 1.Array.map () 此方法是给数组中的每项数据都添加一个方法，结果作为一个新的数组返回，并不会改变原来的数组。 2 2.Array. forEach,7.Array.push () … 8 8.Array.pop () … 更多项目)</p>
<p>数组:</p>
<ol>
<li><p>map()  给数组中的每项数据都添加一个方法，结果作为一个新的数组返回，并<strong>不会改变原来的数组</strong></p>
</li>
<li><p>forEach()：给数组的每一项数据循环添加一个方法，和map不同的是，forEach<strong>改变原数组</strong>，没有返回值</p>
</li>
<li><p>filter()：筛选向方法中传入一个判断条件，将满足条件的值变成一个新的数组返回，<strong>改变原数组</strong></p>
</li>
<li><p>every：将所有元素进行判断返回一个布尔值，如果所有元素都满足判断条件的话，则返回true，如果不满足就返回 false。遍历数组每一项，若全部为true，才返回true ,否则返回false</p>
</li>
<li><p>some()：和every类似，唯一区别就是some遍历数组中的每一项，若其中一项为true,则返回值是true，every遍历数组每一项，若全部为true，才返回true ,否则返回false。</p>
</li>
<li><p>reduce()：为数组中的每一个元素依次执行回调函数，不包括数组中被删除或从未被赋值的元素，接受四个参数：初始值（或者上一次回调函数的返回值），当前元素值，当前索引，调用 reduce 的数组。可以用来写求和求积。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">newArr</span> = (<span class="params">a,b,c,d</span>)=&gt;&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&#x27;上一次调用回调返回的值，或者是提供&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b+<span class="string">&#x27;当前元素&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c+<span class="string">&#x27;当前元素的索引&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d+<span class="string">&#x27;调用reduce的数组&quot;);</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">let sum = arr.reduce(newArr)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//打印结果</span></span><br><span class="line"><span class="string">1上一次调用回调返回的值，或者是提供的初始值</span></span><br><span class="line"><span class="string">2当前元素</span></span><br><span class="line"><span class="string">1当前元素的索引</span></span><br><span class="line"><span class="string">1,2,3,4,5,10调用reduce的数组</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>push():用来向数组末尾添加一个或多个元素，返回新增后数组的长度。</p>
</li>
<li><p>pop():删除数组中的最后一位元素，并返回数组，<strong>改变数组的长度</strong>。</p>
</li>
<li><p>shift():删除数组中的第一个元素，并返回数组，此方法会<strong>改变数组长度</strong></p>
</li>
<li><p>unshift():向数组前添加一个或多个元素，并返回数组，此方法<strong>会改变数组长度</strong></p>
</li>
<li><p>isArray():是用来判断一个对象是不是数组，是的话返回true，不是返回false</p>
</li>
<li><p>concat():是一个可以将多个数组合并成一个数组的方法</p>
</li>
<li><p>toString():是用来将数组转变为字符串格式</p>
</li>
<li><p>join():是将数组转换为字符串，但和toString不同的是join可以设置元素之间的间隔</p>
</li>
<li><p>splice(开始位置， 删除的个数，元素),万能的方法可以实现数组的增、删、改,<em>更改的时候传的第二个参数为0表示不删除</em>,<strong>会改变数组长度</strong></p>
</li>
<li><p>slice():返回从原数组中指定开始下表到结束下表之间的项组成的新数组（<strong>原数组不变</strong>）截取数组</p>
</li>
<li><p>includes():用来判断数组中是否有传入的元素，有的话返回true，没有的话返回false</p>
</li>
<li><p>indexOf():从数组的开头向后查找，接受两个参数，要查找的项和查找起点的位置索引</p>
</li>
<li><p>sort():按指定的参数对数组进行排序，返回的值是经过排序后的数组（无参，函数），<strong>改变原数组</strong></p>
<p>数组名.sort(function (a,b) {return a-b}) 会正序排列</p>
<p>数组名.sort(function (a,b) {return b-a}) 会倒序排列</p>
</li>
<li><p>reverse（） 翻转数组,<strong>改变原数组</strong></p>
</li>
<li><p>join（）：把一个数组转成字符串，<strong>不改变原数组</strong></p>
</li>
<li><p>find（）用来获取数组中满足条件的第一个数据</p>
<p>语法: 数组名.find(function (item,index,arr) {})</p>
<ul>
<li>item : 这个表示的是数组中的每一项</li>
<li>index : 这个表示的是每一项对应的索引</li>
<li>arr : 这个表示的是原数组</li>
</ul>
<p>返回值: 如果有 就是满足条件的第一个数据；如果没有就是undefined，<strong>注意</strong>: 要以return的形式执行返回条件</p>
</li>
<li><p>fill():用来替换数组中的元素，会改变原数组。接受三个参数，</p>
<p>第一个参数为替换的值，如果只传入一个值会吧数组中的值全部替换</p>
<p>第二个参数是标记为从第几个位置开始替换,会从标记的位置开始把后面的元素全部替换</p>
<p>第三个参数是结束时的索引</p>
</li>
</ol>
<p>对象:</p>
<ol>
<li><p>Object.assign():用于克隆对象，传入两个参数，第一个参数为原对象，第二个参数为需要克隆的对象。会合并为一个新的对象，<strong>改变第一个参数的对象</strong>。</p>
</li>
<li><p>Object.is():是用来比较的接受两个参数，第一个参数是需要比较的第一个值，第二个参数是需要比较的第二个值。返回值：布尔值，如果两个值相同返回true，不相同返回false。</p>
<ol>
<li><blockquote>
<p>注意，该函数与&#x3D;&#x3D;运算符不同，不会强制转换任何类型，应该更加类似于**&#x3D;&#x3D;&#x3D;，但值得注意的是它会将+0和-0视作不同值**</p>
</blockquote>
</li>
</ol>
</li>
<li><p>Object.keys():是用来获取对象的key值的。返回一个包含key值的数组</p>
</li>
<li><p>Object.defineProperty():为设置对象的属性的属性特征 value设置属性名，enumerable设置该属性是否可以被枚举。未设置的枚举的属性不能被for in遍历和keys获取。<br>该方法接受三个参数，第一个参数为要加入属性的对象，第二个参数为属性的key值，第三个参数为一个对象。</p>
</li>
<li><p>Object.defineProperties():可添加多个属性,与Object.defineProperty()对应</p>
</li>
<li><p>Object.isPrototypeOf():是用来检查一个对象是否存在另一个对象的原型链中，如果没有则返回<code>null</code></p>
</li>
<li><p>Object.assign():浅拷贝对象，相同的值会被覆盖为新值</p>
<ul>
<li>参数1为接受拷贝的对象，参数2为传递拷贝的对象</li>
<li>结果<strong>会改变第一个参数对象</strong>，同时会返回这个参数对象</li>
</ul>
</li>
<li><p>Object.proxy():用于修改某些操作的默认行为</p>
<ul>
<li>它在目标对象之前架设了一层<strong>拦截</strong>，外界对该对象的访问，都<strong>必须先通过这层拦截</strong></li>
<li>因此它提供了一种机制，可以对外界的访问进行<strong>过滤和改写</strong></li>
<li><code>proxy</code>：代理，这里表示用它来代理某些操作</li>
</ul>
</li>
<li><p>Object.setPrototypeOf():用于设置指定对象的新原型</p>
</li>
<li><p>Object.prototype.isPrototypeOf():用于检测一个对象是否存在于另一个对象的原型链上</p>
</li>
<li><p>Object.toLocaleString():使用<code>toLocaleString</code>可以将对象根据语言环境来转换字符串</p>
</li>
<li></li>
</ol>
<h4 id="Date对象"><a href="#Date对象" class="headerlink" title="Date对象"></a>Date对象</h4><p><code>toLocaleTimeString()</code> ：是 JavaScript 中的一个 Date 对象的方法，用于将日期时间转换为本地时间的字符串表示。</p>
<p>该方法可以接受一个可选的选项参数，用于指定返回字符串的格式。如果不提供选项参数，则返回的字符串格式由本地环境决定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">const</span> localTime = now.<span class="title function_">toLocaleTimeString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(localTime); <span class="comment">// 输出本地时间的字符串表示，例如 &quot;10:15:30 AM&quot; 或 &quot;2:15:30 PM&quot;。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指定参数</span></span><br><span class="line"><span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">const</span> options = &#123; <span class="attr">hour12</span>: <span class="literal">false</span>, <span class="attr">timeZone</span>: <span class="string">&#x27;UTC&#x27;</span> &#125;;<span class="comment">// 24 小时制时间 时区为 UTC</span></span><br><span class="line"><span class="keyword">const</span> utcTime = now.<span class="title function_">toLocaleTimeString</span>(<span class="string">&#x27;en-US&#x27;</span>, options);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(utcTime); <span class="comment">// 输出 UTC 时间的字符串表示，例如 &quot;14:15:30&quot;。 //语言代码为 &#x27;en-US&#x27;,返回英文</span></span><br></pre></td></tr></table></figure>



<h4 id="js-解析-URL的方法"><a href="#js-解析-URL的方法" class="headerlink" title="js 解析 URL的方法"></a>js 解析 URL的方法</h4><p>基本了解：[详解使用 JavaScript 解析 URL的方法-js教程-PHP中文网](<a target="_blank" rel="noopener" href="https://www.php.cn/js-tutorial-464895.html#:~:text=%E8%AF%A6%E8%A7%A3%E4%BD%BF%E7%94%A8">https://www.php.cn/js-tutorial-464895.html#:~:text=详解使用</a> JavaScript 解析 URL的方法 1 开始 创建一个以下内容的 HTML,对象，如下所示： … 7 扩展 获取 URL 的中参数 )</p>
<p>使用 URLSearchParams 解析查询url参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> searchParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(myURL.<span class="property">search</span>);</span><br></pre></td></tr></table></figure>

<p>可以通过调用 <code>searchParams.get（&#39;key&#39;）</code>来获取特定键的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(searchParams.<span class="title function_">get</span>(<span class="string">&#x27;x&#x27;</span>));</span><br><span class="line"><span class="comment">// Output: &quot;y&quot;</span></span><br></pre></td></tr></table></figure>

<p>获取参数</p>
<ol>
<li><p>正则法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryString</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;(^|&amp;)&#x27;</span> + name + <span class="string">&#x27;=([^&amp;]*)(&amp;|$)&#x27;</span>, <span class="string">&#x27;i&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> r = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>).<span class="title function_">match</span>(reg);</span><br><span class="line">    <span class="keyword">if</span> (r != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">unescape</span>(r[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这样调用：</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">GetQueryString</span>(<span class="string">&quot;参数名1&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>split拆分法 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">GetRequest</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> url = location.<span class="property">search</span>; <span class="comment">//获取url中&quot;?&quot;符后的字串</span></span><br><span class="line">    <span class="keyword">var</span> theRequest = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> str = url.<span class="title function_">substr</span>(<span class="number">1</span>);</span><br><span class="line">        strs = str.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; strs.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">            theRequest[strs[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">0</span>]] = <span class="built_in">unescape</span>(strs[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> theRequest;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Request</span> = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="title class_">Request</span> = <span class="title class_">GetRequest</span>();</span><br></pre></td></tr></table></figure>



<p>修改 URL 的中某个参数值</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//替换指定传入参数的值,paramName为参数,replaceWith为新值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">replaceParamVal</span>(<span class="params">paramName,replaceWith</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> oUrl = <span class="variable language_">this</span>.<span class="property">location</span>.<span class="property">href</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">var</span> re=<span class="built_in">eval</span>(<span class="string">&#x27;/(&#x27;</span>+ paramName+<span class="string">&#x27;=)([^&amp;]*)/gi&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> nUrl = oUrl.<span class="title function_">replace</span>(re,paramName+<span class="string">&#x27;=&#x27;</span>+replaceWith);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">location</span> = nUrl;</span><br><span class="line">　　<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=nUrl</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="vue部分"><a href="#vue部分" class="headerlink" title="vue部分"></a>vue部分</h2><h4 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h4><p><code>template slot-scope=&quot;scope&quot;</code> 是 Vue.js 中的 <code>&lt;slot&gt;</code> 元素的一个特殊用法，主要用于向插槽中传递额外的数据。</p>
<p>在使用 <code>&lt;slot&gt;</code> 元素时，我们可以向插槽中传递一些数据，但是这些数据必须要在父组件中定义好。如果我们想要向插槽中传递一些由子组件自己计算出的数据，就需要使用 <code>template slot-scope=&quot;scope&quot;</code> 语法。</p>
<p>这个语法的作用是告诉 Vue.js，当子组件向插槽中插入内容时，需要将一个名为 scope 的对象传递进去。父组件可以通过这个 scope 对象访问子组件中计算出来的数据。</p>
<p>下面是一个例子：</p>
<!-- 子组件中 -->

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-bind:msg</span>=<span class="string">&quot;computedMsg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">computedMsg</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<!-- 父组件中 -->

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ChildComponent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; scope.msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ChildComponent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，子组件通过 <code>v-bind:msg=&quot;computedMsg&quot;</code> 将计算出来的数据绑定到了插槽中。父组件通过 <code>template slot-scope=&quot;scope&quot;</code> 声明了一个名为 scope 的变量，并通过 <code>&#123;&#123; scope.msg &#125;&#125;</code> 访问了子组件中传递进来的数据。</p>
<p>再举个例子：</p>
<!--子组件`test.vue`-->

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;!-- 设置默认值：&#123;&#123;user.<span class="property">lastName</span>&#125;&#125;获取 <span class="title class_">Jun</span> --&gt;</span><br><span class="line">	&lt;!-- 如果home.<span class="property">vue</span>中给这个插槽值的话，则不显示 <span class="title class_">Jun</span> --&gt;</span><br><span class="line">	&lt;!-- 设置一个 usertext 然后把user绑到设置的 usertext 上 --&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-bind:usertext</span>=<span class="string">&quot;user&quot;</span>&gt;</span>&#123;&#123;user.lastName&#125;&#125;<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义内容</span></span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">	<span class="attr">user</span>:&#123;</span><br><span class="line">	  <span class="attr">firstName</span>:<span class="string">&quot;Fan&quot;</span>,</span><br><span class="line">	  <span class="attr">lastName</span>:<span class="string">&quot;Jun&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!--父组件home.vue-->

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">//独占插槽</span><br><span class="line"><span class="tag">&lt;<span class="name">test</span> <span class="attr">v-slot</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span><br><span class="line">  //<span class="tag">&lt;<span class="name">test</span> <span class="attr">v-slot:default</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;slotProps.usertext.firstName&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="登录页面的制作流程"><a href="#登录页面的制作流程" class="headerlink" title="登录页面的制作流程"></a>登录页面的制作流程</h4><ol>
<li><p>页面基本布局</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">autocomplete</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;登录方式&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;accountType&quot;</span> <span class="attr">name</span>=<span class="string">&quot;accountType&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入登录方式&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span> <span class="attr">:loading</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;handleLogin&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>点击<code>handleLogin</code> </p>
<p>首先判断有无<code>username</code>，有的话就存到store里面，再路由跳转</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">username</span> || !<span class="variable language_">this</span>.<span class="property">accountType</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入用户名或登录方式&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span></span><br><span class="line">        .<span class="title function_">dispatch</span>(<span class="string">&#x27;user/login&#x27;</span>, &#123; <span class="attr">username</span>: <span class="variable language_">this</span>.<span class="property">username</span>, <span class="attr">accountType</span>: <span class="variable language_">this</span>.<span class="property">accountType</span> &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="variable language_">this</span>.<span class="property">redirect</span> || <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在store里面判断</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// user login</span></span><br><span class="line">  <span class="title function_">login</span>(<span class="params">&#123; commit &#125;, userInfo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">login</span>(userInfo)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; token, userInfo &#125; = data</span><br><span class="line">          <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOKEN&#x27;</span>, token)</span><br><span class="line">          <span class="title function_">commit</span>(<span class="string">&#x27;SET_USERINFO&#x27;</span>, userInfo)</span><br><span class="line">          <span class="title function_">setToken</span>(token)</span><br><span class="line">          <span class="title function_">resolve</span>(data)</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>其中有一点需要注意：<u><code>commit</code> 是一个重要的方法，用于提交一个 <code>mutation</code> 函数来修改类似于全局状态（state）这样的数据。在 Vuex 中定义的 <code>mutations</code> 函数中，<code>commit</code> 是作为参数传递的。</u></p>
</li>
</ol>
<h2 id="react部分"><a href="#react部分" class="headerlink" title="react部分"></a>react部分</h2><h4 id="组件基本使用"><a href="#组件基本使用" class="headerlink" title="组件基本使用"></a>组件基本使用</h4><p>组件可以被定义为函数，也可以定义为类</p>
<h5 id="类和函数的差异"><a href="#类和函数的差异" class="headerlink" title="类和函数的差异"></a>类和函数的差异</h5><ul>
<li>类（class）是数据和逻辑的封装。 也就是说，组件的状态和操作方法是封装在一起的。如果选择了类的写法，就应该把相关的数据和操作，都写在同一个 class 里面。</li>
</ul>
<p>类组件的缺点 :</p>
<ol>
<li>大型组件很难拆分和重构，也很难测试。</li>
<li>业务逻辑分散在组件的各个方法之中，导致重复逻辑或关联逻辑。</li>
<li>组件类引入了复杂的编程模式，比如 render props 和高阶组件。</li>
</ol>
<ul>
<li>函数一般来说，只应该做一件事，就是返回一个值。 如果你有多个操作，每个操作应该写成一个单独的函数。而且，数据的状态应该与操作方法分离。根据这种理念，React 的函数组件只应该做一件事情：返回组件的 HTML 代码，而没有其他的功能，这样的函数一般称为纯函数</li>
</ul>
<p><code>纯函数</code> :</p>
<ol>
<li><p>函数的返回结果只依赖于它的参数。</p>
</li>
<li><p>不改变函数体外部数据、函数执行过程里面没有副作用。</p>
<p>函数式编程将那些跟数据计算无关的操作，都称为 <code>副效应</code>（side effect） 。如果函数内部直接包含产生副效应的操作，就不再是纯函数了，我们称之为不纯的函数。纯函数内部只有通过间接的手段（即通过其他函数调用），才能包含副效应，即进行数据的各种操作。这里就要引出React Hooks了。</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;example&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  state = &#123; count : <span class="number">1</span>&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  render ()&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> (</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;this.state.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span> = <span class="string">&#123;()</span> =&gt;</span> &#123;console.log(this.state.count)&#125;&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">Address</span>(<span class="params">props</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>网站地址：&#123;props.address&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">DemoName</span>(<span class="params">props</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>网站小名：&#123;props.demoName&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">props</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> ( </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">	<span class="tag">&lt;<span class="name">Name</span> <span class="attr">name</span>=<span class="string">&#x27;菜鸟教程&#x27;</span>/&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">	<span class="tag">&lt;<span class="name">Address</span> <span class="attr">address</span>=<span class="string">&#x27;http://www.runoob.com&#x27;</span>/&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">	<span class="tag">&lt;<span class="name">DemoName</span> <span class="attr">demoName</span>=<span class="string">&#x27;Runoob&#x27;</span>/&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>,<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="React-State"><a href="#React-State" class="headerlink" title="React State"></a>React State</h4><p>React 把组件看成是一个状态机（State Machines）。通过与用户的交互，实现不同状态，然后渲染 UI，让用户界面和数据保持一致。</p>
<p>React 里，只需更新组件的 state，然后根据新的 state 重新渲染用户界面（不要操作 DOM）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span>= &#123;<span class="attr">date</span>:<span class="keyword">new</span> <span class="title class_">Date</span>()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (    </span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在是&#123;this.state.date.toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Clock</span> /&gt;</span></span>,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>将<strong>生命周期方法</strong>添加到类中，其中用到了<code>setState</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;<span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timerID</span> = <span class="built_in">setInterval</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">tick</span>(),</span><br><span class="line">      <span class="number">1000</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timerID</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">tick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在是 &#123;this.state.date.toLocaleTimeString()&#125;.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Clock</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>数据自顶向下流动</strong>:任何状态始终由某些特定组件所有，并且从该状态导出的任何数据或 UI 只能影响树中下方的组件。</p>
<p>父组件或子组件都不能知道某个组件是有状态还是无状态，并且它们不应该关心某组件是被定义为一个函数还是一个类。</p>
<p> FormattedDate 组件将在其属性中接收到 date 值，并且不知道它是来自 Clock 状态、还是来自 Clock 的属性、亦或手工输入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FormattedDate</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在是 &#123;props.date.toLocaleTimeString()&#125;.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">FormattedDate</span> <span class="attr">date</span>=<span class="string">&#123;this.state.date&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="React-Props"><a href="#React-Props" class="headerlink" title="React Props"></a>React Props</h4><p><strong>state 和 props 主要的区别在于 props 是不可变的，而 state 可以根据与用户交互来改变。</strong></p>
<p>默认props</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HelloMessage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">HelloMessage</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Runoob&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> element = <span class="language-xml"><span class="tag">&lt;<span class="name">HelloMessage</span>/&gt;</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  element,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>State 和 Props组合使用</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WebSite</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>();</span><br><span class="line"> </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;菜鸟教程&quot;</span>,</span><br><span class="line">        <span class="attr">site</span>: <span class="string">&quot;https://www.runoob.com&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Name</span> <span class="attr">name</span>=<span class="string">&#123;this.state.name&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">site</span>=<span class="string">&#123;this.state.site&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Name</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Link</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;this.props.site&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.props.site&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">WebSite</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Props 验证</strong></p>
<p>第一个例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> title = <span class="string">&quot;菜鸟教程&quot;</span>;</span><br><span class="line"><span class="comment">// var title = 123;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTitle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">MyTitle</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MyTitle</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span> /&gt;</span></span>,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>第二个例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> title = <span class="string">&quot;菜鸟教程&quot;</span>;</span><br><span class="line"><span class="comment">// var title = 123;</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MyTitle</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">  <span class="attr">propTypes</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> &#123;this.props.title&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MyTitle</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span> /&gt;</span></span>,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="React事件处理"><a href="#React事件处理" class="headerlink" title="React事件处理"></a>React事件处理</h4><p><strong>基本使用</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;<span class="attr">isToggleOn</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">    <span class="comment">// 这边绑定是必要的，这样 `this` 才能在回调函数中使用</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleClick</span> = <span class="variable language_">this</span>.<span class="property">handleClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">isToggleOn</span>: !prevState.<span class="property">isToggleOn</span></span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.state.isToggleOn ? &#x27;ON&#x27; : &#x27;OFF&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>向事件处理程序传递参数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Popper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;<span class="attr">name</span>:<span class="string">&#x27;Hello world!&#x27;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">preventPop</span>(<span class="params">name, e</span>)&#123;    <span class="comment">//事件对象e要放在最后</span></span><br><span class="line">        e.<span class="title function_">preventDefault</span>();</span><br><span class="line">        <span class="title function_">alert</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* 通过 bind() 方法传递参数。 */&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://reactjs.org&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.preventPop.bind(this,this.state.name)&#125;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="react-hooks"><a href="#react-hooks" class="headerlink" title="react-hooks"></a>react-hooks</h4><h5 id="useState-：状态钩子"><a href="#useState-：状态钩子" class="headerlink" title="useState()：状态钩子"></a>useState()：状态钩子</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>  <span class="title function_">Button</span>(<span class="params"></span>)  &#123;</span><br><span class="line">  <span class="keyword">const</span>  [buttonText, setButtonText] =  <span class="title function_">useState</span>(<span class="string">&quot;Click me,   please&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>)  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">setButtonText</span>(<span class="string">&quot;Thanks, been clicked!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span>  <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>&#123;buttonText&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>useState()</code>这个函数接受状态的初始值，作为参数，上例的初始值为按钮的文字。该函数返回一个数组，数组的第一个成员是一个变量（上例是<code>buttonText</code>），指向状态的当前值。第二个成员是一个函数，用来更新状态，约定是<code>set</code>前缀加上状态的变量名（上例是<code>setButtonText</code>）。</p>
<h5 id="useContext-：共享状态钩子"><a href="#useContext-：共享状态钩子" class="headerlink" title="useContext()：共享状态钩子"></a>useContext()：共享状态钩子</h5><p>如果需要在组件之间共享状态，可以使用<code>useContext()</code>。</p>
<p>现在有两个组件 Navbar 和 Messages，我们希望它们之间共享状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;App&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Navbar</span>/&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Messages</span>/&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>第一步就是使用 React Context API，在组件外部建立一个 Context。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AppContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>组件封装代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">AppContext</span>.<span class="property">Provider</span> value=&#123;&#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&#x27;superawesome&#x27;</span></span><br><span class="line">&#125;&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Navbar</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Messages</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">AppContext</span>.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure>

<p>上面代码中，<code>AppContext.Provider</code>提供了一个 Context 对象，这个对象可以被子组件共享。</p>
<p>Navbar 组件的代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Navbar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username &#125; = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>AwesomeSite<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;username&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Message 组件的代码也类似</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Messages</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username &#125; = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;messages&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Messages<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>1 message for &#123;username&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;message&quot;</span>&gt;</span>useContext is awesome!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="useReducer-：action-钩子"><a href="#useReducer-：action-钩子" class="headerlink" title="useReducer()：action 钩子"></a>useReducer()：action 钩子</h5><p>React 本身不提供状态管理功能，通常需要使用外部库。这方面最常用的库是 Redux。</p>
<p>Redux 的核心概念是，组件发出 action 与状态管理器通信。状态管理器收到 action 以后，使用 Reducer 函数算出新的状态，Reducer 函数的形式是<code>(state, action) =&gt; newState</code>。</p>
<p><code>useReducers()</code>钩子用来引入 Reducer 功能。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面是<code>useReducer()</code>的基本用法，它接受 Reducer 函数和状态的初始值作为参数，返回一个数组。数组的第一个成员是状态的当前值，第二个成员是发送 action 的<code>dispatch</code>函数。</p>
<p>下面是一个计数器的例子。用于计算状态的 Reducer 函数如下。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">myReducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.<span class="property">type</span>)  &#123;</span><br><span class="line">    <span class="keyword">case</span>(<span class="string">&#x27;countUp&#x27;</span>):</span><br><span class="line">      <span class="keyword">return</span>  &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span>  state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>组件代码如下。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(myReducer, &#123; <span class="attr">count</span>:   <span class="number">0</span> &#125;);</span><br><span class="line">  <span class="keyword">return</span>  (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;countUp&#x27; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        +1</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Count: &#123;state.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="useEffect-：副作用钩子"><a href="#useEffect-：副作用钩子" class="headerlink" title="useEffect()：副作用钩子"></a>useEffect()：副作用钩子</h5><p><code>useEffect()</code>用来引入具有副作用的操作，最常见的就是向服务器请求数据。以前，放在<code>componentDidMount</code>里面的代码，现在可以放在<code>useEffect()</code>。</p>
<p><code>useEffect()</code>的用法如下。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()  =&gt;</span>  &#123;</span><br><span class="line">  <span class="comment">// Async Action</span></span><br><span class="line">&#125;, [dependencies])</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面用法中，<code>useEffect()</code>接受两个参数。第一个参数是一个函数，异步操作的代码放在里面。第二个参数是一个数组，用于给出 Effect 的依赖项，只要这个数组发生变化，<code>useEffect()</code>就会执行。第二个参数可以省略，这时每次组件渲染时，就会执行<code>useEffect()</code>。</p>
<p>下面看一个例子。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Person</span> = (<span class="params">&#123; personId &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setLoading</span>(<span class="literal">true</span>); </span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://swapi.co/api/people/<span class="subst">$&#123;personId&#125;</span>/`</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setPerson</span>(data);</span><br><span class="line">        <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, [personId])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loading === <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading ...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You&#x27;re viewing: &#123;person.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Height: &#123;person.height&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Mass: &#123;person.mass&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，每当组件参数<code>personId</code>发生变化，<code>useEffect()</code>就会执行。组件第一次渲染时，<code>useEffect()</code>也会执行。</p>
<h5 id="useCallback-记忆函数"><a href="#useCallback-记忆函数" class="headerlink" title="useCallback 记忆函数"></a>useCallback 记忆函数</h5><p>在类组件中，我们经常犯下面这样的错误：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> <span class="attr">14</span> &#125;&#125; <span class="attr">doSomething</span>=<span class="string">&#123;</span> () =&gt;</span> &#123; console.log(&#x27;do something&#x27;); &#125;&#125;  /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样写有什么坏处呢？一旦 App 组件的 props 或者状态改变了就会触发重渲染，即使跟 SomeComponent 组件不相关，<strong>由于每次 render 都会产生新的 style 和 doSomething（因为重新render前后， style 和 doSomething分别指向了不同的引用）</strong>，所以会导致 SomeComponent 重新渲染，倘若 SomeComponent 是一个大型的组件树，这样的 Virtual Dom 的比较显然是很浪费的，解决的办法也很简单，将参数抽离成变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fontSizeStyle = &#123; <span class="attr">fontSize</span>: <span class="number">14</span> &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    doSomething = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;do something&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">style</span>=<span class="string">&#123;fontSizeStyle&#125;</span> <span class="attr">doSomething</span>=<span class="string">&#123;</span> <span class="attr">this.doSomething</span> &#125;  /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在类组件中，我们还可以通过 this 这个对象来存储函数，而在函数组件中没办法进行挂载了。所以函数组件在每次渲染的时候如果有传递函数的话都会重渲染子组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Click happened&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">SomeComponent</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里多说一句，一版把函数式组件理解为class组件render函数的语法糖，所以每次重新渲染的时候，函数式组件内部所有的代码都会重新执行一遍。所以上述代码中每次render，handleClick都会是一个新的引用，所以也就是说传递给SomeComponent组件的props.onClick一直在变(因为每次都是一个新的引用)，所以才会说这种情况下，函数组件在每次渲染的时候如果有传递函数的话都会重渲染子组件。</p>
</blockquote>
<p>而有了 useCallback 就不一样了，你可以通过 useCallback 获得一个记忆后的函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> memoizedHandleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Click happened&#x27;</span>)</span><br><span class="line">  &#125;, []); <span class="comment">// 空数组代表无论什么情况下该函数都不会发生改变</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;memoizedHandleClick&#125;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">SomeComponent</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>老规矩，第二个参数传入一个数组，数组中的每一项一旦值或者引用发生改变，useCallback 就会重新返回一个新的记忆函数提供给后面进行渲染。</p>
<p>这样只要子组件继承了 PureComponent 或者使用 React.memo 就可以有效避免不必要的 VDOM 渲染。</p>
<h5 id="useMemo-记忆组件"><a href="#useMemo-记忆组件" class="headerlink" title="useMemo 记忆组件"></a>useMemo 记忆组件</h5><p>useCallback 的功能完全可以由 useMemo 所取代，如果你想通过使用 useMemo 返回一个记忆函数也是完全可以的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useCallback</span>(fn, inputs)    ===   <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> fn, inputs).</span><br></pre></td></tr></table></figure>

<p>所以前面使用 useCallback 的例子可以使用 useMemo 进行改写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> memoizedHandleClick = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Click happened&#x27;</span>)</span><br><span class="line">  &#125;, []); <span class="comment">// 空数组代表无论什么情况下该函数都不会发生改变</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;memoizedHandleClick&#125;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">SomeComponent</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>唯一的区别是：<strong>useCallback 不会执行第一个参数函数，而是将它返回给你，而 useMemo 会执行第一个函数并且将函数执行结果返回给你</strong>,所以在前面的例子中，可以返回 handleClick 来达到存储函数的目的。</p>
<p><em>所以 useCallback 常用记忆事件函数，生成记忆后的事件函数并传递给子组件使用。而 useMemo 更适合经过函数计算得到一个确定的值，比如记忆组件。</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">&#123; a, b &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> child1 = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child1</span> <span class="attr">a</span> = <span class="string">&#123;</span> <span class="attr">a</span> &#125;/&gt;</span></span>, [a])</span><br><span class="line">  <span class="keyword">const</span> child2 = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child2</span> <span class="attr">b</span> = <span class="string">&#123;</span> <span class="attr">b</span> &#125;/&gt;</span></span>, [b])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;child1&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;child2&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当 a&#x2F;b 改变时，child1&#x2F;child2 才会重新渲染。从例子可以看出来，只有在第二个参数数组的值发生变化时，才会触发子组件的更新。</p>
<h5 id="useRef-保存引用值"><a href="#useRef-保存引用值" class="headerlink" title="useRef 保存引用值"></a>useRef 保存引用值</h5><p>useRef 跟 createRef 类似，都可以用来生成对 DOM 对象的引用，看个简单的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&quot;Nate&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> nameRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">submitButton</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setName</span>(nameRef.<span class="property">current</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;nameRef&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;submitButton&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Submit</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<p>useRef 返回的值传递给组件或者 DOM 的 ref 属性，就可以通过 ref.current 值访问组件或真实的 DOM 节点，重点是组件也是可以访问到的，从而可以对 DOM 进行一些操作，比如监听事件等等。</p>
<p>当然 useRef 远比你想象中的功能更加强大，useRef 的功能有点像类属性，或者说您想要在组件中记录一些值，并且这些值在稍后可以更改。</p>
<p>利用 useRef 就可以绕过 Capture Value 的特性。可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态，而不会在每个 Render 间存在隔离。</p>
<p>React Hooks 中存在 Capture Value 的特性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;count: &quot;</span> + count);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;增加 count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count - 1)&#125;&gt;减少 count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先点击增加button，后点击减少button，3秒后先alert 1，后alert 0，而不是alert两次0。这就是所谓的 capture value 的特性。而在类组件中 3 秒后输出的就是修改后的值，因为这时候 message 是挂载在 this 变量上，它保留的是一个引用值，对 this 属性的访问都会获取到最新的值。讲到这里你应该就明白了，useRef 创建一个引用，就可以有效规避 React Hooks 中 Capture Value 特性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">showCount</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;count: &quot;</span> + count.<span class="property">current</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = number =&gt; &#123;</span><br><span class="line">    count.<span class="property">current</span> = count.<span class="property">current</span> + number;</span><br><span class="line">    <span class="built_in">setTimeout</span>(showCount, <span class="number">3000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count.current&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleClick(1)&#125;&gt;增加 count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleClick(-1)&#125;&gt;减少 count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要将赋值与取值的对象变成 useRef，而不是 useState，就可以躲过 capture value 特性，在 3 秒后得到最新的值。</p>
<h5 id="useImperativeHandle-穿透-Ref"><a href="#useImperativeHandle-穿透-Ref" class="headerlink" title="useImperativeHandle 穿透 Ref"></a>useImperativeHandle 穿透 Ref</h5><p>主要用于向父组件暴露子组件的实例属性或方法。它用于在函数式组件中定义外部（or 父组件）可以通过 <code>ref</code> 访问的函数或属性。</p>
<p>通过 useImperativeHandle 用于让父组件获取子组件内的索引</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef, useEffect, useImperativeHandle, forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChildInputComponent</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> inputRef.<span class="property">current</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;child input&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ChildInput</span> = <span class="title function_">forwardRef</span>(<span class="title class_">ChildInputComponent</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ChildInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过这种方式，App 组件可以获得子组件的 input 的 DOM 节点。</p>
<p>其中<code>forwardRef</code> 是一个 React 高阶函数，它接受一个函数组件作为参数，并返回一个新的组件。新组件可以将 <code>ref</code> 属性传递到内部的子组件中。通过这种方式，函数组件就可以使用 <code>ref</code> 引用子组件，并直接访问其 DOM 元素，或者调用其方法。</p>
<h5 id="useLayoutEffect-同步执行副作用"><a href="#useLayoutEffect-同步执行副作用" class="headerlink" title="useLayoutEffect 同步执行副作用"></a>useLayoutEffect 同步执行副作用</h5><p>大部分情况下，使用 useEffect 就可以帮我们处理组件的副作用，但是如果想要同步调用一些副作用，比如对 DOM 的操作，就需要使用 useLayoutEffect，useLayoutEffect 中的副作用会在 DOM 更新之后同步执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#title&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> titleWidth = title.<span class="title function_">getBoundingClientRect</span>().<span class="property">width</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useLayoutEffect&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (width !== titleWidth) &#123;</span><br><span class="line">      <span class="title function_">setWidth</span>(titleWidth);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useEffect&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;width&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在上面的例子中，useLayoutEffect 会在 render，DOM 更新之后同步触发函数，会优于 useEffect 异步触发函数。</p>
<h5 id="useEffect和useLayoutEffect有什么区别"><a href="#useEffect和useLayoutEffect有什么区别" class="headerlink" title="useEffect和useLayoutEffect有什么区别"></a>useEffect和useLayoutEffect有什么区别</h5><p>简单来说就是调用时机不同，useLayoutEffect和原来<code>componentDidMount&amp;componentDidUpdate</code>一致，在react完成DOM更新后马上同步调用的代码，会阻塞页面渲染。而useEffect是会在整个页面渲染完才会调用的代码。</p>
<h5 id="创建自己的-Hooks"><a href="#创建自己的-Hooks" class="headerlink" title="创建自己的 Hooks"></a>创建自己的 Hooks</h5><p>上例的 Hooks 代码还可以封装起来，变成一个自定义的 Hook，便于共享。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">usePerson</span> = (<span class="params">personId</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setLoading</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://swapi.co/api/people/<span class="subst">$&#123;personId&#125;</span>/`</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setPerson</span>(data);</span><br><span class="line">        <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, [personId]);  </span><br><span class="line">  <span class="keyword">return</span> [loading, person];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>usePerson()</code>就是一个自定义的 Hook。</p>
<p>Person 组件就改用这个新的钩子，引入封装的逻辑。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Person</span> = (<span class="params">&#123; personId &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [loading, person] = <span class="title function_">usePerson</span>(personId);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loading === <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading ...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You&#x27;re viewing: &#123;person.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Height: &#123;person.height&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Mass: &#123;person.mass&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="如何把数据存到react-redux中？"><a href="#如何把数据存到react-redux中？" class="headerlink" title="如何把数据存到react-redux中？"></a>如何把数据存到react-redux中？</h4><p>使用 <code>React-redux</code> 可以很方便地将 Redux 与 React 应用集成起来。<br>具体来说，要将数据存储到 React-Redux 中，需要完成以下几个步骤：</p>
<p>1.创建一个 Redux store 对象，这个对象包含应用程序的全部状态（也就是数据）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span>; <span class="comment">// 定义所有 reducer 的根 reducer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(rootReducer);</span><br></pre></td></tr></table></figure>

<p>2.在组件中获取数据，通过 <code>connect</code> 函数将组件和 <code>Redux store</code> 连接起来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = (<span class="params">state</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: state.<span class="property">data</span> <span class="comment">// 从 state 中获取需要的数据</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params">&#123; data &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 使用 data 渲染组件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps)(<span class="title class_">MyComponent</span>);</span><br></pre></td></tr></table></figure>

<p>3.将数据存储到 Redux Store 中，通过 Action 和 Reducer 来更新 Store 中的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// action.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ADD_DATA</span> = <span class="string">&#x27;ADD_DATA&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">addData</span> = (<span class="params">data</span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="variable constant_">ADD_DATA</span>,</span><br><span class="line">  <span class="attr">payload</span>: data</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reducer.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ADD_DATA</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">data</span>: [] &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">rootReducer</span> = (<span class="params">state = initialState, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">ADD_DATA</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">data</span>: [...state.<span class="property">data</span>, action.<span class="property">payload</span>] &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>

<p>4.获取数据</p>
<p>&#x2F;&#x2F; 在组件中触发 action</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addData &#125; <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params">&#123; dispatch &#125;</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">addData</span>(data));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="真实项目中使用"><a href="#真实项目中使用" class="headerlink" title="真实项目中使用"></a>真实项目中使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  postLogin,</span><br><span class="line">    fetchUserInfo,</span><br><span class="line">    fetchLogout,</span><br><span class="line">  &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/useraction&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> userModel = &#123;</span><br><span class="line">    <span class="attr">namespace</span>: <span class="string">&#x27;useraction&#x27;</span>,</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">      <span class="attr">userInfo</span>: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">effects</span>: &#123;</span><br><span class="line">      *<span class="title function_">fetchLogin</span>(<span class="params">&#123; payload &#125;, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">yield</span> <span class="title function_">call</span>(postLogin, payload);</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (response &amp;&amp; response.<span class="property">success</span>) &#123;</span><br><span class="line">          <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;saveUserInfo&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">data</span>: response.<span class="property">result</span> || &#123;&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(response || <span class="string">&#x27;登录成功&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(response || <span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line"> </span><br><span class="line">      *<span class="title function_">fetchUserInfo</span>(<span class="params">&#123; payload &#125;, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">yield</span> <span class="title function_">call</span>(fetchUserInfo, payload);</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (response &amp;&amp; response.<span class="property">success</span>) &#123;</span><br><span class="line">          <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;saveUserInfo&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">userInfo</span>: response.<span class="property">result</span> || &#123;&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response.<span class="property">message</span> || <span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">  </span><br><span class="line">      *<span class="title function_">fetchLogout</span>(<span class="params">&#123; payload &#125;, &#123; call &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">yield</span> <span class="title function_">call</span>(fetchLogout, payload);</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (response &amp;&amp; response.<span class="property">success</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(response.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response.<span class="property">message</span> || <span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">  </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">saveUserInfo</span>(<span class="params">state, &#123; payload &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userInfo = &#123;&#125; &#125; = payload;</span><br><span class="line">        <span class="keyword">return</span> &#123; ...state, userInfo &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">clearUserInfo</span>(<span class="params">state</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; ...state, <span class="attr">userInfo</span>: &#123;&#125; &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> userModel;</span><br></pre></td></tr></table></figure>

<p><strong>effects</strong>是<code>Redux-Saga</code>的方法，<code>Redux-Saga</code> 采用了一种不同的方式来处理异步操作。它使用类似于 Generator 的函数（称为 Saga），以同步的方式描述应用程序中的异步流。这大大简化了处理复杂异步流程的难度。</p>
<p><code>call</code> 和 <code>put</code> 是在 Redux-Saga 中常用的两个效用函数，用于进行 Saga 任务的调用和更新 Redux state。</p>
<p><strong>call</strong> 函数是 Redux-Saga 中用于向异步函数发起调用的函数。它的作用是类似于 JavaScript 的 <code>await</code> 关键字，用于等待一个异步操作完成，并将结果返回给 Saga 参与的函数。<code>call</code> 函数的基本语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> <span class="title function_">call</span>(fn, ...args)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>fn</code> 是需要被调用的异步函数，可以是任何返回 Promise 的函数；</li>
<li><code>args</code> 是传递给异步函数的参数列表，可以是空的，也可以是一个数组或对象。</li>
</ul>
<p><code>call</code> 函数接收一个函数和可选参数，并返回一个 Effect（表示需要发起实际调用的指令）。</p>
<p>使用 <code>call</code> 函数可以使 Saga 任务代码更易于测试和维护，同时也能处理一些失败和错误的情况。</p>
<p><strong>put</strong>函数是 Redux-Saga 中用于更新 Redux store 的函数，用于向 store 发送一个 action 并触发更新。通常，Saga 会使用 <code>put</code> 发起 action 以响应操作或事件，从而更新 store 中的 state。<code>put</code> 函数的基本语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> <span class="title function_">put</span>(action)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>action</code> 是将要被发送到 store 的 action 对象。</li>
</ul>
<p>在 Saga 中使用 <code>put</code> 函数更新 state 的好处是它能够避免在组件之间进行复杂的传递，而且它遵循 Flux 模式的单向数据流规则。</p>
<h4 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">validatePhone</span> = (<span class="params">_, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> phoneRegex = <span class="regexp">/^[1][3-9]\d&#123;9&#125;$/</span>;</span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; !phoneRegex.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;请输入正确的手机号&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">label</span>=<span class="string">&quot;手机号&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">message:</span> &#x27;<span class="attr">请输入手机号</span>!&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  &#123; <span class="attr">validator:</span> <span class="attr">validatePhone</span> &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="使用Dva封装的useDva"><a href="#使用Dva封装的useDva" class="headerlink" title="使用Dva封装的useDva"></a>使用Dva封装的useDva</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  dispatch,</span><br><span class="line">  loadings,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">memberdoc</span>: &#123; <span class="title class_">MemberDocList</span> = &#123;&#125; &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125; = <span class="title function_">useDva</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="string">&#x27;memberdoc/fetchMemberDocList&#x27;</span>,</span><br><span class="line">    <span class="attr">importloading</span>: <span class="string">&#x27;memberdoc/fetchMemberDocList&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="string">&#x27;memberdoc&#x27;</span>],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>使用 useDva 钩子来获取 获取 Redux store 中的memberdoc数据。useDva 是一个由 <code>Dva.js</code> 提供的 React 钩子，用于在 React 组件中连接 Dva.js 的数据和业务逻辑。<br><code>useDva</code> 钩子接受两个参数。</p>
<ul>
<li><p>第一个参数是一个对象，用于配置控制 Dva.js 钩子的行为。对象中的每个属性都是一个字符串，用于在组件中控制某个异步操作的加载状态。</p>
</li>
<li><p>第二个参数是一个字符串数组，用于告诉 useDva 钩子哪些 Dva.js model 的数据是组件感兴趣的。</p>
<p>dva中两个常用的hooks函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;dva&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line"><span class="keyword">let</span> name=<span class="title function_">useSelector</span>(<span class="function"><span class="params">store</span>=&gt;</span>store.<span class="property">index</span>.<span class="property">name</span>)</span><br></pre></td></tr></table></figure>

<p><code>useDispatch</code> 是一个 React hook 函数，它返回一个 Redux store 中的 <code>dispatch</code> 函数。通过 <code>dispatch</code> 函数，可以触发一个 action，从而更新对应的 state。</p>
<p><code>useSelector</code> 也是一个 React hook 函数，它返回 Redux store 中 state 的特定部分。可以使用该 hook 来监听 state 的变化，当 state 发生变化时，会自动重新渲染组件。</p>
</li>
</ul>
<h4 id="渲染子组件"><a href="#渲染子组件" class="headerlink" title="渲染子组件"></a>渲染子组件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> noMatch = (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Result</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">status</span>=<span class="string">&#123;403&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">title</span>=<span class="string">&quot;403&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">subTitle</span>=<span class="string">&quot;没有权限访问该页面&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">extra</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &lt;<span class="attr">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/portal&quot;</span>&gt;</span>返回首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#125;</span></span><br><span class="line"><span class="language-xml">  /&gt;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Authorized</span> <span class="attr">authority</span>=<span class="string">&#123;authorized.authority&#125;</span> <span class="attr">noMatch</span>=<span class="string">&#123;noMatch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">QueryParamProvider</span> <span class="attr">history</span>=<span class="string">&#123;props.history&#125;</span> <span class="attr">currentUser</span>=<span class="string">&#123;props.currentUser&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">QueryParamProvider</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><code>authority</code> 是一个字符串或数组，用于指定用户的权限。<code>Authorized</code> 组件会根据该权限和当前路由的权限要求进行比较，决定是否渲染子组件。如果权限符合要求，则渲染子组件；否则，渲染 <code>noMatch</code> 属性指定的组件。这里使用了一个变量 <code>authorized.authority</code> 来作为 <code>Authorized</code> 组件的 <code>authority</code> 属性值。</p>
<h4 id="request-js"><a href="#request-js" class="headerlink" title="request.js"></a>request.js</h4><p><code>umi-request</code> 是一个基于 <code>Fetch</code> API 封装的网络请求库，用于发送 HTTP 请求。通过使用它，我们可以方便地发送请求，并且具有以下优点：</p>
<ul>
<li>支持拦截器：我们可以通过拦截器对请求和响应进行拦截和处理，方便统一处理错误、添加认证等操作。</li>
<li>支持取消请求：当一个请求已经发出但是我们不需要等待它完成时，可以通过 <code>cancel</code> 方法取消该请求。</li>
<li>支持防止重复提交：我们可以使用 loading 状态来避免用户在请求尚未完成时重复提交请求。</li>
<li>支持配置全局和单个请求的参数和选项。</li>
</ul>
<p>在应用中使用 <code>umi-request</code> 需要先安装该库：<code>npm install umi-request</code>。然后我们就可以在代码中引入该库，并使用 <code>extend</code> 函数来创建请求实例。</p>
<h5 id="路由跳转"><a href="#路由跳转" class="headerlink" title="路由跳转"></a>路由跳转</h5><p><strong>声明式</strong>,通过 Link 使用，通常作为 React 组件使用。</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (  <span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list&quot;</span>&gt;</span>Go to list page<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>);</span><br></pre></td></tr></table></figure>

<p>命令式,通过 history 使用，通常在事件处理中被调用。history可用于获取当前路由信息，详情可见<a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/api#history">API (umijs.org)</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; history &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">goToListPage</span>(<span class="params"></span>) &#123;  history.<span class="title function_">push</span>(<span class="string">&#x27;/list&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>也可以直接从组件的属性中取得 history</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>props.history.push(&#x27;/list&#x27;);&#125;&gt;Go to list page<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;umi-request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notification, message &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; history &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; rmAuthority &#125; <span class="keyword">from</span> <span class="string">&#x27;./authority&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getProjectToken, rmProjectToken &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">errorHandler</span> = (<span class="params">error</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; response &#125; = error;</span><br><span class="line">  <span class="keyword">if</span> (!response) &#123;</span><br><span class="line">    notification.<span class="title function_">error</span>(&#123;</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;您的网络发生异常，无法连接服务器&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;网络异常&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置request请求时的默认参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = <span class="title function_">extend</span>(&#123;</span><br><span class="line">  errorHandler,</span><br><span class="line">  <span class="comment">// 默认错误处理</span></span><br><span class="line">  <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>, <span class="comment">// 默认请求是否带上cookie</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// request拦截器, 改变url 或 options.</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">url, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> tokenOptions = <span class="title function_">getProjectToken</span>() ? &#123; <span class="string">&#x27;X-Access-Token&#x27;</span>: <span class="string">`<span class="subst">$&#123;getProjectToken()&#125;</span>`</span> &#125; : &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> newOptions = &#123; ...options &#125;;</span><br><span class="line">  newOptions.<span class="property">headers</span> = &#123;</span><br><span class="line">    ...tokenOptions,</span><br><span class="line">    <span class="string">&#x27;tenant-id&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    ...newOptions.<span class="property">headers</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  newOptions.<span class="property">data</span> = options.<span class="property">data</span> || options.<span class="property">body</span> || &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    url,</span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      ...newOptions,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">async</span> (response, options) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> responseJson = <span class="keyword">await</span> response.<span class="title function_">clone</span>().<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; code &#125; = responseJson;</span><br><span class="line">  <span class="keyword">if</span> (code === <span class="number">401</span>) &#123;</span><br><span class="line">    message.<span class="title function_">config</span>(&#123;</span><br><span class="line">      <span class="attr">maxCount</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    message.<span class="title function_">error</span>(<span class="string">&#x27;登录过期，请重新登录&#x27;</span>);</span><br><span class="line">    <span class="title function_">rmAuthority</span>();</span><br><span class="line">    <span class="title function_">rmProjectToken</span>();</span><br><span class="line">    history.<span class="title function_">replace</span>(&#123;</span><br><span class="line">      <span class="attr">pathname</span>: <span class="string">&#x27;/user-action/login&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h4 id="Umi"><a href="#Umi" class="headerlink" title="Umi"></a>Umi</h4><h5 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── package.json  //包含插件和插件集，以 @umijs/preset-、@umijs/plugin-、umi-preset- 和 umi-plugin- 开头的依赖会被自动注册为插件或插件集。</span><br><span class="line">├── .umirc.ts //配置文件，包含 umi 内置功能和插件的配置。</span><br><span class="line">├── .env //环境变量</span><br><span class="line">├── dist  //执行 umi build 后，产物默认会存放在这里。</span><br><span class="line">├── mock //存储 mock 文件，此目录下所有 js 和 ts 文件会被解析为 mock 文件。</span><br><span class="line">├── public //此目录下所有文件会被 copy 到输出路径。</span><br><span class="line">└── src</span><br><span class="line">    ├── .umi  //临时文件目录，比如入口文件、路由等，都会被临时生成到这里。不要提交 .umi 目录到 git 仓库，他们会在 umi dev 和 umi build 时被删除并重新生成。</span><br><span class="line">    ├── layouts/index. //约定式路由时的全局布局文件。</span><br><span class="line">    ├── pages  //所有路由组件存放在这里。</span><br><span class="line">        ├── index.less</span><br><span class="line">        └── index.tsx</span><br><span class="line">    └── app.ts //运行时配置文件，可以在这里扩展运行时的能力，比如修改路由、修改 render 方法等。</span><br></pre></td></tr></table></figure>

<h5 id="常见的Api"><a href="#常见的Api" class="headerlink" title="常见的Api"></a>常见的Api</h5><ul>
<li>dynamic:动态加载组件</li>
<li>history:可用于获取当前路由信息history.length;可用于路由跳转history.push…;也可用于路由监听history.listen</li>
<li>Link:链接组件</li>
<li>NavLink:特殊版本的 <code>&lt;Link /&gt;</code> 。当指定路由（<code>to=指定路由</code>）命中时，可以附着特定样式。</li>
<li>Prompt:提供一个用户离开页面时的提示选择。</li>
<li>withRouter:高阶组件，可以通过 <code>withRouter</code> 获取到 <code>history</code>、<code>location</code>、<code>match</code> 对象</li>
<li>useHistory:hooks，获取 <code>history</code> 对象</li>
<li>useLocation:hooks，获取 <code>location</code> 对象</li>
<li>useParams:hooks，获取 <code>params</code> 对象。 <code>params</code> 对象为动态路由（例如：<code>/users/:id</code>）里的参数键值对。</li>
<li>useRouteMatch:获取当前路由的匹配信息。</li>
</ul>
<h2 id="hexo基础使用"><a href="#hexo基础使用" class="headerlink" title="hexo基础使用"></a>hexo基础使用</h2><p><code>SONG-GF.github.io</code>访问</p>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>前面记得加 <strong>npx</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hexo new&quot;postName&quot;      #新建文章</span><br><span class="line">hexo new page&quot;pageName&quot; #新建页面</span><br><span class="line">hexo generate           #生成静态页面至public目录</span><br><span class="line">hexo clean              #清除生成内容</span><br><span class="line">hexo server             #开启预览访问端口（默认端口4000，&#x27;ctrl + c&#x27;关闭server）</span><br><span class="line">hexo deploy             #将.deploy目录部署到指定空间</span><br><span class="line">hexo help               # 查看帮助</span><br><span class="line">hexo version            #查看hexo的版本</span><br></pre></td></tr></table></figure>

<h3 id="hexo缩写"><a href="#hexo缩写" class="headerlink" title="hexo缩写"></a>hexo缩写</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo g：hexo generate</span><br><span class="line">hexo c：hexo clean</span><br><span class="line">hexo s：hexo server</span><br><span class="line">hexo d：hexo deploy</span><br></pre></td></tr></table></figure>

<h3 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改主题</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/04/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="clihlah5l0000yguo3hl71qyo" data-title="" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/06/04/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 SONG-GF<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>